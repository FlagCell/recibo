<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Recibo Simples</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 20px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      box-sizing: border-box;
      margin-top: 5px;
    }
    .assinatura {
      margin-top: 40px;
      text-align: center;
    }
    button {
      margin-top: 30px;
      padding: 12px;
      font-size: 16px;
      width: 100%;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center">RECIBO</h2>

  <label>Nome de quem pagou:</label>
  <input type="text" id="nome">

  <label>Tipo de documento de quem pagou:</label>
  <select id="tipoDocPagador">
    <option value="cpf">CPF</option>
    <option value="cnpj">CNPJ</option>
  </select>

  <label>Número do CPF ou CNPJ (opcional):</label>
  <input type="text" id="docPagador" placeholder="Apenas números">

  <label>Valor (R$):</label>
  <input type="text" id="valor" oninput="atualizarExtenso()">

  <label>Valor por extenso:</label>
  <input type="text" id="extenso" readonly>

  <label>Referente a:</label>
  <textarea id="referente" rows="3"></textarea>

  <label>Forma de pagamento:</label>
  <select id="forma">
    <option value="">Selecione</option>
    <option>Dinheiro</option>
    <option>Pix</option>
    <option>Transferência</option>
    <option>Cartão de crédito</option>
    <option>Cartão de débito</option>
    <option>Cheque</option>
    <option>Outro</option>
  </select>

  <label>Cidade:</label>
  <input type="text" id="cidade">

  <label>Data:</label>
  <input type="date" id="data">

  <label>Nome de quem recebeu:</label>
  <input type="text" id="recebedor">

  <label>Tipo de documento de quem recebeu:</label>
  <select id="tipoDocRecebedor">
    <option value="cpf">CPF</option>
    <option value="cnpj">CNPJ</option>
  </select>

  <label>CPF ou CNPJ de quem recebeu (opcional):</label>
  <input type="text" id="docRecebedor" placeholder="Somente números">

  <div class="assinatura">
    <p>__________________________________________</p>
    <p>(Assinatura de quem recebeu)</p>
  </div>

  <button onclick="gerarPDF()">Gerar PDF com 2 vias</button>

  <script>
    function atualizarExtenso() {
      const input = document.getElementById('valor').value.replace(',', '.').replace(/[^0-9.]/g, '');
      const valor = parseFloat(input);
      const campo = document.getElementById('extenso');
      if (isNaN(valor)) {
        campo.value = '';
        return;
      }
      campo.value = numeroParaExtenso(valor);
    }

    function numeroParaExtenso(valor) {
      const unidades = ['zero', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
      const dezenas10 = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
      const dezenas = ['', '', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
      const centenas = ['', 'cem', 'cento', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];

      function extenso(n) {
        if (n === 0) return 'zero';
        let s = '';
        if (n >= 1000) {
          const mil = Math.floor(n / 1000);
          s += mil === 1 ? 'mil' : extenso(mil) + ' mil';
          n %= 1000;
          if (n > 0) s += ' e ';
        }
        if (n >= 100) {
          const c = Math.floor(n / 100);
          if (c === 1 && n % 100 === 0) {
            s += 'cem';
            n = 0;
          } else {
            s += centenas[c + 1];
            n %= 100;
            if (n > 0) s += ' e ';
          }
        }
        if (n >= 20) {
          s += dezenas[Math.floor(n / 10)];
          n %= 10;
          if (n > 0) s += ' e ';
        } else if (n >= 10) {
          s += dezenas10[n - 10];
          n = 0;
        }
        if (n > 0 && n < 10) {
          s += unidades[n];
        }
        return s;
      }

      const inteiro = Math.floor(valor);
      const centavos = Math.round((valor - inteiro) * 100);
      let texto = extenso(inteiro) + ' real' + (inteiro !== 1 ? 's' : '');
      if (centavos > 0) {
        texto += ' e ' + extenso(centavos) + ' centavo' + (centavos !== 1 ? 's' : '');
      }
      return texto.charAt(0).toUpperCase() + texto.slice(1);
    }

    function formatarDataBR(dataISO) {
      if (!dataISO) return '';
      const [ano, mes, dia] = dataISO.split('-');
      return `${dia}/${mes}/${ano}`;
    }

    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;
      let soma = 0;
      for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i);
      let resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(9))) return false;
      soma = 0;
      for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i);
      resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      return resto === parseInt(cpf.charAt(10));
    }

    function validarCNPJ(cnpj) {
      cnpj = cnpj.replace(/[^\d]+/g, '');
      if (cnpj.length !== 14 || /^(\d)\1+$/.test(cnpj)) return false;
      let t = cnpj.length - 2, d = cnpj.substring(t), d1 = parseInt(d.charAt(0)), d2 = parseInt(d.charAt(1));
      const calc = x => {
        let n = cnpj.substring(0, x);
        let y = x - 7, s = 0;
        for (let i = x; i >= 1; i--) {
          s += n.charAt(x - i) * y--;
          if (y < 2) y = 9;
        }
        const r = 11 - s % 11;
        return r > 9 ? 0 : r;
      };
      return calc(t) === d1 && calc(t + 1) === d2;
    }
    function gerarPDF() {
      const nome = document.getElementById('nome').value;
      const tipoPagador = document.getElementById('tipoDocPagador').value;
      const docPagador = document.getElementById('docPagador').value;
      const tipoRecebedor = document.getElementById('tipoDocRecebedor').value;
      const docRecebedor = document.getElementById('docRecebedor').value;
      const valor = document.getElementById('valor').value;
      const extenso = document.getElementById('extenso').value;
      const referente = document.getElementById('referente').value;
      const forma = document.getElementById('forma').value;
      const cidade = document.getElementById('cidade').value;
      const data = formatarDataBR(document.getElementById('data').value);
      const recebedor = document.getElementById('recebedor').value;

      if (docPagador) {
        const validoPagador = tipoPagador === 'cpf' ? validarCPF(docPagador) : validarCNPJ(docPagador);
        if (!validoPagador) {
          alert(`O ${tipoPagador.toUpperCase()} do pagador é inválido.`);
          return;
        }
      }

      if (docRecebedor) {
        const validoRecebedor = tipoRecebedor === 'cpf' ? validarCPF(docRecebedor) : validarCNPJ(docRecebedor);
        if (!validoRecebedor) {
          alert(`O ${tipoRecebedor.toUpperCase()} do recebedor é inválido.`);
          return;
        }
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      function recibo(offsetY) {
        let y = 10 + offsetY;
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text("RECIBO", 105, y, { align: "center" });

        doc.setFontSize(11);
        y += 10;

        function linha(rotulo, valor) {
          if (!valor) return;
          doc.setFont(undefined, 'bold');
          doc.text(`${rotulo}:`, 10, y);
          const largura = doc.getTextWidth(`${rotulo}: `);
          doc.setFont(undefined, 'normal');
          doc.text(valor.toString(), 10 + largura, y);
          y += 7;
        }

        linha("Recebi de", nome);
        if (docPagador) linha(tipoPagador.toUpperCase(), docPagador);
        linha("Valor", `R$ ${valor}`);
        linha("Valor por extenso", extenso);
        linha("Referente a", referente);
        linha("Forma de pagamento", forma);
        linha("Cidade", cidade);
        linha("Data", data);

        y += 20;
        doc.setFont(undefined, 'normal');
        doc.text("__________________________________________", 105, y, { align: "center" });
        y += 6;
        doc.text(recebedor || "Assinatura de quem recebeu", 105, y, { align: "center" });

        if (docRecebedor) {
          y += 6;
          doc.setFont(undefined, 'bold');
          doc.text(`${tipoRecebedor.toUpperCase()} do recebedor:`, 105, y, { align: "center" });
          y += 6;
          doc.setFont(undefined, 'normal');
          doc.text(docRecebedor, 105, y, { align: "center" });
        }
      }

      recibo(0);

      doc.setLineWidth(0.1);
      doc.setDrawColor(120);
      doc.setLineDashPattern([2, 2], 0);
      doc.line(10, 145, 200, 145); // linha de corte

      recibo(155);

      doc.save("recibo.pdf");
    }
  </script>
</body>
</html>
